<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="minimum-scale=1.0, width=device-width, maximum-scale=1, user-scalable=no, viewport-fit=cover"
        name="viewport"/>
  <script src='https://code.jquery.com/jquery-2.2.4.min.js'></script>

  <title>Title</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="./lib/letsee-0.9.20.js"></script>

  <style type="text/css" media="place">
    #container {
      -letsee-target: uri('korloy-product.json');
      -letsee-transform: translate(0, 0, 0);
      background: rgba(76, 175, 80, 0.3);
      width: 100px;
      height: 300px;
      color: white;
      border: 2px solid red;
    }
  </style>
</head>
<body>

<div id="container">
  <a href="http://www.example.com/myfile.pdf#page=4">Hello</a>
</div>
<div id="buttonContainer">
  <button id="startButton">스캐닝 시작</button>
</div>

<!-- 하단 푸터 네비게이터 -->
<!-- 1.비디오보기, 2.pdf파일 열기 3.정품인증 4.공구계산기 -->
<div id="bottomNav">
  <button class="bottomNavButton">
    <img class="bottomNavButtonImage" src="assets/ico-video@3x.png"/>
    <h4 class="bottomNavButtonText">Video<br/>Manual</h4>
  </button>
  <button class="bottomNavButton" onclick="location.href='https://drive.google.com/file/d/1YeiJOokclN0WyuRB8xkRk_kTFjRj1uBA/view?usp=sharing'">
    <img class="bottomNavButtonImage" src="assets/ico-pdf@3x.png"/>
    <h4 class="bottomNavButtonText">Product<br/>Guide</h4>
  </button>
  <button class="bottomNavButton">
    <img class="bottomNavButtonImage" onclick="productCertScreenController(1)" src="assets/ico-certi@3x.png"/>
    <h4 class="bottomNavButtonText">Genuine<br/>Check</h4>
  </button>
  <button class="bottomNavButton">
    <img class="bottomNavButtonImage" src="assets/ico-calculator@3x.png"/>
    <h4 class="bottomNavButtonText">KTS<br/>
      <h4 style="visibility: hidden">dummy</h4>
    </h4>
  </button>
</div>

<!-- 정품인증 Barcode 가이드 화면 -->
<div id="barcodeGuide" style="display: none">
  <img id="barcodeGuideImage" src="assets/text-guide@3x.png"/>
  <div id="barcodeGuideInnerBox"></div>
</div>


<script>
  const config = {
    // appKey: '417e8094b7ba9bf9632d8cc5aa94b57fd65582d2d3d2112233e0a727d0d59d05',
    trackerType: 'IMAGE',
    bodyId: 'fallback-test'
  };
  window.addEventListener('load', function () {
    initialBarcodeReader();
    startLetsee();
  });
</script>

<script type="text/javascript" src="https://unpkg.com/@zxing/library@latest"></script>

<script>
  // Letsee init
  function startLetsee() {
    letsee.init(config, () => {
      console.log('Loaded 됨!');
      // for test
      // letsee.setVideoSource('b805681e340a7dcbb9688c5b81e960cca210ed3fbfebe7212971f1ad491183ca');
      letsee.setVideoSource('environment');
    });
    document.getElementsByTagName('video')[1].setAttribute('id','video');
  }

  // 초기 바코드 Reader init
  function initialBarcodeReader() {
    let selectedDeviceId;
    const codeReader = new ZXing.BrowserMultiFormatReader();
    console.log('ZXing code reader 초기화 성공~');
    codeReader.getVideoInputDevices()
      .then((videoInputDevices) => {
        console.log(videoInputDevices);
        /**
         * 해당 부분에서 비디오 input 디바이스 목록을 얻어옴.
         */
        selectedDeviceId = videoInputDevices[1].deviceId;
        console.log(selectedDeviceId);
        // const sourceSelect = document.getElementById('sourceSelect');
        // if (videoInputDevices.length >= 1) {
        //   videoInputDevices.forEach((element) => {
        //     const sourceOption = document.createElement('option');
        //     sourceOption.text = element.label;
        //     sourceOption.value = element.deviceId;
        //     sourceSelect.appendChild(sourceOption)
        //   });
        //
        //   sourceSelect.onchange = () => {
        //     selectedDeviceId = sourceSelect.value;
        //   };
        //
        //   const sourceSelectPanel = document.getElementById('sourceSelectPanel')
        //   sourceSelectPanel.style.display = 'block'
        // }
        document.getElementById('startButton').addEventListener('click', () => {
          codeReader.decodeFromVideoDevice(selectedDeviceId, 'video', (result, err) => {
            if (result) {
              console.log(result);
              // document.getElementById('result').textContent = result.text
            }
            if (err && !(err instanceof ZXing.NotFoundException)) {
              console.error(err);
              // document.getElementById('result').textContent = err
            }
          });
          console.log(`Started continous decode from camera with id ${selectedDeviceId}`)
        });

        // document.getElementById('resetButton').addEventListener('click', () => {
        //   codeReader.reset();
        //   document.getElementById('result').textContent = '';
        //   console.log('Reset.')
        // })

      })
      .catch((err) => {
        console.error(err)
      })
  }

  // 데이터 Matrix로부터 넘어온 String을 파싱함.
  function parseProductNumberFromString(str) {

  }

  // ----------- Dom, 화면 관련 메서드 ------------- //
  let screenStack = 0;
  function productCertScreenController(screenStack) {
    let BARCODE_GUIDE = $("#barcodeGuide");
    switch (screenStack) {
      case 0:
        BARCODE_GUIDE.hide();
        break;
      case 1:
        BARCODE_GUIDE.show();
        break;
      case 2:
        break;
    }
  }

</script>
</body>
</html>
